import{_ as s,c as i,a4 as e,j as t,o as n}from"./chunks/framework.su6J3y5l.js";const r="/tech_insight/assets/three-way-handshake-1.Dubxfzsw.png",h="/tech_insight/assets/three-way-handshake-2.DGEoltWm.png",l="/tech_insight/assets/three-way-handshake-2.DGEoltWm.png",F=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"_firewall.md","filePath":"_firewall.md","lastUpdated":1732976097000}'),p={name:"_firewall.md"};function o(d,a,k,c,u,b){return n(),i("div",null,a[0]||(a[0]=[e(`<h2 id="网络工具" tabindex="-1">网络工具 <a class="header-anchor" href="#网络工具" aria-label="Permalink to &quot;网络工具&quot;">​</a></h2><p>Fndroid clash 内核</p><p><a href="https://clash.wiki/introduction/getting-started.html" target="_blank" rel="noreferrer">clash wiki</a></p><p><strong>windwos GUI</strong></p><p><a href="https://github.com/clash-verge-rev/clash-verge-rev" target="_blank" rel="noreferrer">clashx-pro-rev</a><a href="https://github.com/2dust/v2rayN" target="_blank" rel="noreferrer">v2rayN</a><strong>macos GUI</strong><a href="https://nssurge.com/" target="_blank" rel="noreferrer">surge</a><a href="https://stash.ws/" target="_blank" rel="noreferrer">Stash</a><a href="https://archive.org/download/clash_for_windows_pkg" target="_blank" rel="noreferrer">clash-for-windows-backup</a></p><p><strong>andorid GUI</strong></p><p>[surfboard]</p><p><strong>IOS GUI</strong></p><p>Quantumult x / shadowRocket / surge / Loon / Stash (purchased in app store)</p><p>Windows 系统：</p><pre><code>Clash Verge 下载
V2rayN 下载
NekoRay 下载
sing-box 下载
</code></pre><p>Mac 客户端：</p><pre><code>Clash Verge （Intel 芯片）下载
Clash Verge （M 芯片） 下载
Stash for Mac 下载
Surge for Mac 下载
sing-box 下载
</code></pre><p>Android 客户端：</p><pre><code>Clash 测试版下载
NekoBox 下载
Clash You 下载
Surfboard 下载
v2rayNG 下载
sing-box 下载
</code></pre><p>iOS 客户端：</p><pre><code>Shadowrocket 下载
Quantumult X 下载
Loon 下载
Surge for iOS 下载
sing-box 下载
</code></pre><p>路由器客户端：</p><pre><code>OpenClash 下载
ShellClash 下载
Passwall 下载
SSR Plus 下载
</code></pre><h2 id="网络环境检测" tabindex="-1">网络环境检测 <a class="header-anchor" href="#网络环境检测" aria-label="Permalink to &quot;网络环境检测&quot;">​</a></h2><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">networksetup</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -getwebproxy</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Wi-Fi</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Enabled:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Yes</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Server:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 127.0.0.1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Port:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 6152</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Authenticated</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Proxy</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Enabled:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="network-connection-troubleshooting-steps" tabindex="-1">network connection troubleshooting steps <a class="header-anchor" href="#network-connection-troubleshooting-steps" aria-label="Permalink to &quot;network connection troubleshooting steps&quot;">​</a></h2><h3 id="域名劫持和污染" tabindex="-1">域名劫持和污染 <a class="header-anchor" href="#域名劫持和污染" aria-label="Permalink to &quot;域名劫持和污染&quot;">​</a></h3><p>使用OpenDNS（208.67.222.222）或GoogleDNS（8.8.8.8）第三方的DNS服务器 自己用VPS搭建DNS服务器 修改机器host文件，直接IP访问 domain name may not be resolved locally at all. 域名可能根本无法在本地解析。</p><h3 id="ip封锁" tabindex="-1">ip封锁 <a class="header-anchor" href="#ip封锁" aria-label="Permalink to &quot;ip封锁&quot;">​</a></h3><p>使用HTTP代理。客户端不在直接请求目标服务器，而是请求代理服务器，代理服务器在去请求目标服务器。 对于HTTP代理来说，封锁起来非常简单。因为HTTP协议是明文，Request Message中就带有要请求的URL或IP地址，这样很容易就被检测到。对于HTTPS来说，虽然通信是进行加密了，但是在建连之前会给代理服务器发送CONNECT方法，这里也会带上要访问的远端服务器地址。如果代理服务器在国外，在出去前就会被检测到。 如果代理服务器在国内，呵呵，你也出不去啊。</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>CONNECT: www.google.com</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>http/https/socks5 代理、机场流量转发 (懂的)、软路由 (相当强悍)、MitM&amp;readWrite (比金瓶梅 Charles 好用)、DNS 代理、模块和脚本</p><h2 id="socket" tabindex="-1">socket <a class="header-anchor" href="#socket" aria-label="Permalink to &quot;socket&quot;">​</a></h2><p>client sent http session based</p><p>IM即时通讯 server sent 消息需要及时推送到client,连接中断清理服务器资源</p><h3 id="socket的三重身份" tabindex="-1">socket的三重身份 <a class="header-anchor" href="#socket的三重身份" aria-label="Permalink to &quot;socket的三重身份&quot;">​</a></h3><p>socket as library: 网络接口的实现集合 域名解析 <code>gethostbyname</code> 应用层调用 Socket 库接口，把数据给到传输层，后面数据才能够发出去</p><p>互联网上两个终端 (比如客户端和服务器) 如果需要通讯，就需要知道对方的 IP 和 Port IP 通过 gethostbyname 已经拿到了，Port 应用层在请求的时候已经知道，比如 HTTP 默认 80，HTTPS 默认 443</p><p>data storage <code>gethostbyname</code> 接口把解析出请求终端的ip和port存储到了套接字 <code>connect</code> 接口把三次握手状态记录到了套接字中。</p><p>socket中间件 TCP 在丢包控制、流量控制、拥塞控制方面是碾压 UDP 的。上面的三次握手就是在做稳定连接的工作，而其他四个方面就是通过滑动窗口和拥塞窗口实现的</p><h3 id="webscoket" tabindex="-1">webscoket <a class="header-anchor" href="#webscoket" aria-label="Permalink to &quot;webscoket&quot;">​</a></h3><p>WebSocket 和 HTTP 一样属于应用层协议，WebSocket 通过 HTTP 建立连接，然后不断开通道</p><h3 id="why-heart-心跳机制要解决什么问题" tabindex="-1">why heart,心跳机制要解决什么问题 <a class="header-anchor" href="#why-heart-心跳机制要解决什么问题" aria-label="Permalink to &quot;why heart,心跳机制要解决什么问题&quot;">​</a></h3><p>终端网络波动太大：尤其移动端特别明显，进出电梯时候的网络屏蔽、网络供应商切换时候的 IP 更换、高速移动过程中基站的变更等等 NAT 超时后映射会销毁，中断通路：是运营商为了节省资源和降低网关压力，对一段时间没有数据收发的连接，会清理掉。这时候终端和服务端都是完好的，但是中间的通路却断了。 企业等防火墙：会在一段时间后关闭网络包传输。这个和 NAT 超时类似，防火墙会定时对一段时间没有数据收发对连接进行关闭，如 5 分钟。</p><h2 id="tcp数据传输过程" tabindex="-1">TCP数据传输过程 <a class="header-anchor" href="#tcp数据传输过程" aria-label="Permalink to &quot;TCP数据传输过程&quot;">​</a></h2><h3 id="数据包长度" tabindex="-1">数据包长度 <a class="header-anchor" href="#数据包长度" aria-label="Permalink to &quot;数据包长度&quot;">​</a></h3><p>网络层一个网络包的最大长度，为 65535 字节: 2^16-1，约64KB, 用于标记一个包大小的位数是16位</p><p>链路层MTU 分片。</p><h3 id="数据包丢包" tabindex="-1">数据包丢包 <a class="header-anchor" href="#数据包丢包" aria-label="Permalink to &quot;数据包丢包&quot;">​</a></h3><p>UDP 会进行数据校验（UDP 的头部有 16 位大小的” 校验和” 字段），发现数据不完整，就会丢弃。</p><h3 id="drop-the-pakcaet" tabindex="-1">drop the pakcaet <a class="header-anchor" href="#drop-the-pakcaet" aria-label="Permalink to &quot;drop the pakcaet&quot;">​</a></h3><h3 id="数据包超时重传" tabindex="-1">数据包超时重传 <a class="header-anchor" href="#数据包超时重传" aria-label="Permalink to &quot;数据包超时重传&quot;">​</a></h3><p>timeout and retry</p><h3 id="三次握手" tabindex="-1">三次握手 <a class="header-anchor" href="#三次握手" aria-label="Permalink to &quot;三次握手&quot;">​</a></h3><div class="info custom-block"><p class="custom-block-title">white-space collapse control</p><p>pre: text-wrapping: no wrap<br> pre-line: sequence of white space(tab) collapse, new lines wrap. text-wrap<br> pre-wrap: sequence of white space(tab) preserve, new lines wrap. text-wrap</p></div>`,51),t("pre",{sytle:"white-space: pre-wrap; background-color: red"},`SYN 是用来请求建立连接（建立套接字）的  
第一次和第二次握手，在 C 和 S 端均发送了 SYN，表示双方均希望建立连接。
而 ACK 是 SYN 的答复，同意建立套接字
第二次和第![](三次握手.png)，在 S 和 C 端均发送了 ACK，表示双方均回执了对方的建立连接请求。
`,-1),e('<p><img src="'+r+'" alt=""></p><p><img src="'+h+'" alt=""></p><p><img src="'+l+`" alt=""></p><h3 id="四次挥手" tabindex="-1">四次挥手 <a class="header-anchor" href="#四次挥手" aria-label="Permalink to &quot;四次挥手&quot;">​</a></h3><h3 id="滑动窗口" tabindex="-1">滑动窗口 <a class="header-anchor" href="#滑动窗口" aria-label="Permalink to &quot;滑动窗口&quot;">​</a></h3><h2 id="代理" tabindex="-1">代理 <a class="header-anchor" href="#代理" aria-label="Permalink to &quot;代理&quot;">​</a></h2><p>查看代理配置 wsl2 vEthernet</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">env</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> proxy</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ipconfig</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IPv4</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 地址</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> :</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 192.168.208.1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> env</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> proxy</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">https_proxy</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">http://192.168.208.1:7897</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">all_proxy</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">http://192.168.208.1:7897</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">http_proxy</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">http://192.168.208.1:7897</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 代理上启用Allow LAN</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="正向代理和反向代理" tabindex="-1">正向代理和反向代理 <a class="header-anchor" href="#正向代理和反向代理" aria-label="Permalink to &quot;正向代理和反向代理&quot;">​</a></h3><p>clien-side aware</p><p>server-side aware</p><p>系统代理 虚拟网卡 scoket hook</p><h2 id="网络代理" tabindex="-1">网络代理 <a class="header-anchor" href="#网络代理" aria-label="Permalink to &quot;网络代理&quot;">​</a></h2><h3 id="系统代理" tabindex="-1">系统代理 <a class="header-anchor" href="#系统代理" aria-label="Permalink to &quot;系统代理&quot;">​</a></h3><h4 id="takeover-a-network-request-of-local-program" tabindex="-1">takeover a network request of local program <a class="header-anchor" href="#takeover-a-network-request-of-local-program" aria-label="Permalink to &quot;takeover a network request of local program&quot;">​</a></h4><p>If the system is configured with a proxy server, the program will not directly connect to the target server when executing a network request, but will instead generate a connection to the proxy server enabling the “Set as System Agent” option will register itself as a proxy server</p><p>As for cli, since they use the POSIX interface to make network requests,configure the proxy through the env variable https_proxy and http_proxy,</p><h4 id="takeover-a-network-request-from-another-device" tabindex="-1">takeover a network request from another device <a class="header-anchor" href="#takeover-a-network-request-from-another-device" aria-label="Permalink to &quot;takeover a network request from another device&quot;">​</a></h4><h4 id="proxy-protocol" tabindex="-1">proxy protocol <a class="header-anchor" href="#proxy-protocol" aria-label="Permalink to &quot;proxy protocol&quot;">​</a></h4><ul><li><p>Inform the proxy server, the hostname and port number of the target server.</p></li><li><p>Send authentication information for proxy server authentication. (optional)</p></li><li><p>Encryption of data transmissions. (optional)</p></li></ul><h3 id="http-proxy-and-tcp-proxy" tabindex="-1">HTTP Proxy and TCP Proxy <a class="header-anchor" href="#http-proxy-and-tcp-proxy" aria-label="Permalink to &quot;HTTP Proxy and TCP Proxy&quot;">​</a></h3><p>HTTP proxy: 代理服务器接收请求，转发请求，获取 HTTP 响应，然后将其转发到客户端</p><h3 id="虚拟网卡" tabindex="-1">虚拟网卡 <a class="header-anchor" href="#虚拟网卡" aria-label="Permalink to &quot;虚拟网卡&quot;">​</a></h3><p>DOH(httpdns)</p>`,24)]))}const y=s(p,[["render",o]]);export{F as __pageData,y as default};
